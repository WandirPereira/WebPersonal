{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\wandi\\\\Documents\\\\2022-Curso-MERN-AgustinNavarro\\\\webPersonal\\\\client\\\\src\\\\contexts\\\\AuthContext.js\",\n  _s = $RefreshSig$();\nimport { useState, useEffect, createContext } from \"react\";\nimport { User, Auth } from \"../api\";\nimport { hasExpiretedToken } from \"../utils\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst userController = new User();\nconst authController = new Auth();\nexport const AuthContext = /*#__PURE__*/createContext();\nexport function AuthProvider(props) {\n  _s();\n  const {\n    children\n  } = props;\n  const [user, setUser] = useState(null);\n  const [token, setToken] = useState(null);\n  const [loading, setLoading] = useState(true);\n  useEffect(() => {\n    //Comprovar que usu치rio est치 logado\n    //console.log(\"Entrou no UserEffect\");\n    //setToken(userControlller.getAccessToken);\n    //setUser();\n    (async () => {\n      const accessToken = authController.getAccessToken();\n      const refreshToken = authController.getRefreshToken();\n      //await login(accessToken);\n      if (!accessToken || !refreshToken) {\n        logout();\n        setLoading(false);\n        return;\n      }\n      if (hasExpiretedToken(accessToken)) {\n        if (hasExpiretedToken(refreshToken)) {\n          logout();\n        } else {\n          await reLogin(refreshToken);\n        }\n      } else {\n        await login(accessToken);\n      }\n      setLoading(false);\n    })();\n  }, []);\n  const reLogin = async refreshToken => {\n    try {} catch (error) {\n      console.error(error);\n    }\n  };\n  const login = async accessToken => {\n    //console.log(\"Login Context\");\n    //console.log(accessToken);\n    try {\n      const response = await userController.getMe(accessToken);\n      //console.log(\"TOKEN\", accessToken);\n      delete response.password;\n      //console.log(response);\n      setUser(response);\n      setToken(accessToken);\n      //console.log(token);\n      //console.log(accessToken);\n      //console.log(user);\n    } catch (error) {\n      console.error(error);\n    }\n  };\n  //console.log(token);\n  //console.log(user);\n\n  const logout = () => {\n    setUser(null);\n    setToken(null);\n    authController.removeTokens();\n  };\n  const data = {\n    accessToken: token,\n    user,\n    login\n  };\n  //console.log(data);\n\n  if (loading) return null;\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: data,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 89,\n    columnNumber: 12\n  }, this);\n}\n_s(AuthProvider, \"uAkFQMmIUxfxJcQTEb8tCM/KFt4=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["useState","useEffect","createContext","User","Auth","hasExpiretedToken","userController","authController","AuthContext","AuthProvider","props","children","user","setUser","token","setToken","loading","setLoading","accessToken","getAccessToken","refreshToken","getRefreshToken","logout","reLogin","login","error","console","response","getMe","password","removeTokens","data"],"sources":["C:/Users/wandi/Documents/2022-Curso-MERN-AgustinNavarro/webPersonal/client/src/contexts/AuthContext.js"],"sourcesContent":["import { useState, useEffect, createContext } from \"react\";\r\nimport { User, Auth } from \"../api\";\r\nimport { hasExpiretedToken } from \"../utils\"\r\n\r\nconst userController = new User();\r\nconst authController = new Auth();\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport function AuthProvider(props){\r\n    const { children } = props;\r\n    const [user, setUser] = useState(null);\r\n    const [token, setToken] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n      //Comprovar que usu치rio est치 logado\r\n      //console.log(\"Entrou no UserEffect\");\r\n      //setToken(userControlller.getAccessToken);\r\n      //setUser();\r\n      (async () => {\r\n        const accessToken = authController.getAccessToken();\r\n        const refreshToken = authController.getRefreshToken();\r\n        //await login(accessToken);\r\n        if(!accessToken || !refreshToken){\r\n            logout();\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        if(hasExpiretedToken(accessToken)){\r\n            if(hasExpiretedToken(refreshToken)){\r\n                logout();\r\n            }else{\r\n                await reLogin(refreshToken);\r\n            }\r\n        }else{\r\n            await login(accessToken);\r\n        }\r\n        \r\n        setLoading(false);\r\n      })();\r\n    }, []);\r\n\r\n\r\n    const reLogin = async (refreshToken) => {\r\n        try {\r\n            \r\n        } catch (error) {\r\n            console.error(error)\r\n;        }\r\n    }\r\n\r\n    const login = async (accessToken) => {\r\n        //console.log(\"Login Context\");\r\n        //console.log(accessToken);\r\n        try {\r\n            const response = await userController.getMe(accessToken);\r\n            //console.log(\"TOKEN\", accessToken);\r\n            delete response.password;\r\n            //console.log(response);\r\n            setUser(response);\r\n            setToken(accessToken);\r\n            //console.log(token);\r\n            //console.log(accessToken);\r\n            //console.log(user);\r\n        } catch (error) {\r\n            console.error(error);\r\n        }\r\n    };\r\n    //console.log(token);\r\n    //console.log(user);\r\n\r\n    const logout = () => {\r\n        setUser(null);\r\n        setToken(null);\r\n        authController.removeTokens();\r\n    };\r\n\r\n    const data = {\r\n        accessToken: token,\r\n        user,\r\n        login,\r\n    };\r\n    //console.log(data);\r\n\r\n    if (loading) return null;\r\n\r\n    return <AuthContext.Provider value={data}>{ children }</AuthContext.Provider>\r\n    \r\n}\r\n\r\n"],"mappings":";;AAAA,SAASA,QAAQ,EAAEC,SAAS,EAAEC,aAAa,QAAQ,OAAO;AAC1D,SAASC,IAAI,EAAEC,IAAI,QAAQ,QAAQ;AACnC,SAASC,iBAAiB,QAAQ,UAAU;AAAA;AAE5C,MAAMC,cAAc,GAAG,IAAIH,IAAI,EAAE;AACjC,MAAMI,cAAc,GAAG,IAAIH,IAAI,EAAE;AAEjC,OAAO,MAAMI,WAAW,gBAAGN,aAAa,EAAE;AAE1C,OAAO,SAASO,YAAY,CAACC,KAAK,EAAC;EAAA;EAC/B,MAAM;IAAEC;EAAS,CAAC,GAAGD,KAAK;EAC1B,MAAM,CAACE,IAAI,EAAEC,OAAO,CAAC,GAAGb,QAAQ,CAAC,IAAI,CAAC;EACtC,MAAM,CAACc,KAAK,EAAEC,QAAQ,CAAC,GAAGf,QAAQ,CAAC,IAAI,CAAC;EACxC,MAAM,CAACgB,OAAO,EAAEC,UAAU,CAAC,GAAGjB,QAAQ,CAAC,IAAI,CAAC;EAE5CC,SAAS,CAAC,MAAM;IACd;IACA;IACA;IACA;IACA,CAAC,YAAY;MACX,MAAMiB,WAAW,GAAGX,cAAc,CAACY,cAAc,EAAE;MACnD,MAAMC,YAAY,GAAGb,cAAc,CAACc,eAAe,EAAE;MACrD;MACA,IAAG,CAACH,WAAW,IAAI,CAACE,YAAY,EAAC;QAC7BE,MAAM,EAAE;QACRL,UAAU,CAAC,KAAK,CAAC;QACjB;MACJ;MAEA,IAAGZ,iBAAiB,CAACa,WAAW,CAAC,EAAC;QAC9B,IAAGb,iBAAiB,CAACe,YAAY,CAAC,EAAC;UAC/BE,MAAM,EAAE;QACZ,CAAC,MAAI;UACD,MAAMC,OAAO,CAACH,YAAY,CAAC;QAC/B;MACJ,CAAC,MAAI;QACD,MAAMI,KAAK,CAACN,WAAW,CAAC;MAC5B;MAEAD,UAAU,CAAC,KAAK,CAAC;IACnB,CAAC,GAAG;EACN,CAAC,EAAE,EAAE,CAAC;EAGN,MAAMM,OAAO,GAAG,MAAOH,YAAY,IAAK;IACpC,IAAI,CAEJ,CAAC,CAAC,OAAOK,KAAK,EAAE;MACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACvB;EACL,CAAC;EAED,MAAMD,KAAK,GAAG,MAAON,WAAW,IAAK;IACjC;IACA;IACA,IAAI;MACA,MAAMS,QAAQ,GAAG,MAAMrB,cAAc,CAACsB,KAAK,CAACV,WAAW,CAAC;MACxD;MACA,OAAOS,QAAQ,CAACE,QAAQ;MACxB;MACAhB,OAAO,CAACc,QAAQ,CAAC;MACjBZ,QAAQ,CAACG,WAAW,CAAC;MACrB;MACA;MACA;IACJ,CAAC,CAAC,OAAOO,KAAK,EAAE;MACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACxB;EACJ,CAAC;EACD;EACA;;EAEA,MAAMH,MAAM,GAAG,MAAM;IACjBT,OAAO,CAAC,IAAI,CAAC;IACbE,QAAQ,CAAC,IAAI,CAAC;IACdR,cAAc,CAACuB,YAAY,EAAE;EACjC,CAAC;EAED,MAAMC,IAAI,GAAG;IACTb,WAAW,EAAEJ,KAAK;IAClBF,IAAI;IACJY;EACJ,CAAC;EACD;;EAEA,IAAIR,OAAO,EAAE,OAAO,IAAI;EAExB,oBAAO,QAAC,WAAW,CAAC,QAAQ;IAAC,KAAK,EAAEe,IAAK;IAAA,UAAGpB;EAAQ;IAAA;IAAA;IAAA;EAAA,QAAyB;AAEjF;AAAC,GAjFeF,YAAY;AAAA,KAAZA,YAAY;AAAA;AAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}